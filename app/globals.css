@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    /* Prevent horizontal scrollbar and layout shift */
    overflow-x: hidden;
    max-width: 100vw;
    /* Hide scrollbar but allow scrolling - set on html too to prevent Radix calculations */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  /* Hide scrollbar on html for WebKit browsers */
  html::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
  }

  body {
    @apply font-primary bg-primary text-white leading-loose;
    /* Fallback font to prevent CLS while custom font loads */
    font-family:
      ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas,
      "Liberation Mono", monospace;
    /* Prevent horizontal scrollbar and layout shift */
    overflow-x: hidden;
    max-width: 100vw;
    /* Hide scrollbar but allow scrolling (like widget) */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    /* CRITICAL: Prevent any padding/margin from being added by Radix UI react-remove-scroll */
    padding-right: 0 !important;
    margin-right: 0 !important;
  }

  /* Hide scrollbar on body for WebKit browsers */
  body::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
  }

  /* AGGRESSIVE: Override Radix UI react-remove-scroll padding/margin in ALL cases */
  body[style*="padding-right"],
  body[style*="margin-right"],
  body.remove-scroll-bar,
  body[data-scroll-locked],
  html[style*="padding-right"],
  html[style*="margin-right"],
  html.remove-scroll-bar,
  html[data-scroll-locked] {
    padding-right: 0 !important;
    margin-right: 0 !important;
  }

  /* Prevent any child elements from causing horizontal overflow */
  /* Moved from widget styles.css to root layer for better control */
  body > * {
    max-width: 100%;
    overflow-x: hidden;
  }

  /* CRITICAL FIX: Prevent inner scrollbars on all containers within viewport */
  /* Target all possible containers that might create inner scrollbars */
  main,
  section,
  div[class*="container"],
  /* Remove overflow from min-h containers - let content flow naturally */
  div[class*="min-h-[90vh]"],
  section[class*="min-h-[90vh]"],
  div[class*="h-screen"],
  div[class*="h-full"] {
    /* Prevent vertical scrollbars unless explicitly needed */
    overflow-y: visible !important;
    overflow: visible !important;
  }

  /* CRITICAL: Override widget CSS that might add scrollbars */
  /* Target widget containers specifically */
  [id*="chatbot"],
  [class*="chatbot"],
  [id*="widget"],
  [class*="widget"],
  iframe[src*="chatbot"],
  iframe[src*="widget"] {
    overflow: visible !important;
    overflow-y: visible !important;
    overflow-x: hidden !important;
  }

  /* Prevent widget CSS from affecting main page containers */
  /* Override any widget styles that might add overflow to body children */
  body
    > div:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not([id*="chatbot"]):not([class*="chatbot"]):not([id*="widget"]):not(
      [class*="widget"]
    ) {
    overflow-y: visible !important;
    overflow: visible !important;
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
  }

  body
    > div:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not([id*="chatbot"]):not([class*="chatbot"]):not([id*="widget"]):not(
      [class*="widget"]
    )::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  .h1 {
    @apply text-[36px] xl:text-[56px] leading-[1.1] font-semibold;
  }
  .h2 {
    @apply text-[28px] xl:text-[32px] leading-[1.1] font-semibold;
  }
  .h3 {
    @apply text-[20px] xl:text-[24px] leading-[1.1] font-semibold;
  }
  .text-outline {
    -webkit-text-stroke: 1px #ffffff;
  }
  .text-outline-hover {
    -webkit-text-stroke: 1px #00ff99;
  }
}

@layer components {
  .animate-count-up {
    animation: countUp 2s ease-out 0.5s both;
    contain: layout style;
  }

  .animate-fade-in {
    animation: fadeIn 0.1s ease-in 0s both;
    contain: layout style;
  }

  .animate-fade-in-delayed {
    animation: fadeIn 0.1s ease-in-out 0s both;
    contain: layout style;
  }

  .animate-spin-slow {
    animation: spin 20s linear infinite;
    contain: layout style;
  }

  .animate-dash-rotate {
    animation: dashRotate 20s ease-in-out infinite reverse;
    contain: layout style;
  }

  .animate-ease-in-out {
    animation: easeInOut 0.5s ease-in-out 1.6s both;
    contain: layout style;
  }

  .animate-ease-out {
    animation: easeOut 0.5s ease-out 0.3s both;
    contain: layout style;
  }

  .animate-ease-in {
    animation: easeIn 0.15s ease-in 0s both;
    contain: layout style;
  }

  .animate-accordion-down {
    animation: accordionDown 0.2s ease-out both;
    contain: layout style;
  }

  .animate-accordion-up {
    animation: accordionUp 0.2s ease-out both;
    contain: layout style;
  }

  /* SIMPLE DIRECT FIX: Hide browser default scrollbars on page content containers */
  /* Keep ONLY custom ScrollArea scrollbars visible */
  /* Target specific page containers - hide their scrollbars immediately */
  .page-content-no-scrollbar {
    /* Hide browser default scrollbar immediately - use !important to override widget styles */
    scrollbar-width: none !important; /* Firefox */
    -ms-overflow-style: none !important; /* IE and Edge */
    /* Prevent overflow that causes scrollbars */
    overflow-y: visible !important;
  }

  .page-content-no-scrollbar::-webkit-scrollbar {
    display: none !important; /* Chrome, Safari, Opera */
    width: 0 !important;
    height: 0 !important;
  }

  /* Also target containers with min-h-[90vh] as fallback - hide scrollbars */
  section[class*="min-h-[90vh]"],
  div[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar) {
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
    overflow-y: visible !important;
    overflow: visible !important;
  }

  section[class*="min-h-[90vh]"]::-webkit-scrollbar,
  div[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar)::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  /* CRITICAL: Remove overflow from max-h containers that create inner scrollbars */
  div[class*="max-h-[90vh]"]:not(.custom-scrollbar):not(
      [data-radix-scroll-area-viewport]
    ) {
    overflow-y: visible !important;
    overflow: visible !important;
    max-height: none !important;
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
  }

  div[class*="max-h-[90vh]"]:not(.custom-scrollbar):not(
      [data-radix-scroll-area-viewport]
    )::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  /* CRITICAL: Prevent any container from creating inner scrollbars */
  /* Target containers with height constraints that might create scrollbars */
  /* Exception: Keep ScrollArea components and custom-scrollbar working */
  div[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not([data-radix-scroll-area-viewport]):not(.custom-scrollbar),
  section[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not([data-radix-scroll-area-viewport]),
  div[class*="max-h-[90vh]"]:not([data-radix-scroll-area-root]):not([data-radix-scroll-area-viewport]):not(.custom-scrollbar),
  /* Target page content containers */
  [class*="animate-ease-in-out"]:not([data-radix-scroll-area-root]):not([data-radix-scroll-area-viewport]):not(.custom-scrollbar) > div,
  [class*="animate-ease-in-out"]:not([data-radix-scroll-area-root]):not([data-radix-scroll-area-viewport]):not(.custom-scrollbar) > section {
    /* Only allow visible overflow, prevent scrollbars */
    overflow-x: hidden;
    /* Let vertical content flow to main page scrollbar - NO inner scrollbars */
    overflow-y: visible !important;
    overflow: visible !important;
  }

  /* Hide scrollbars on these specific containers */
  div[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar)::-webkit-scrollbar,
  section[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    )::-webkit-scrollbar,
  div[class*="max-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar)::-webkit-scrollbar,
  [class*="animate-ease-in-out"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar)
    > div::-webkit-scrollbar,
  [class*="animate-ease-in-out"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar)
    > section::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  div[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar),
  section[class*="min-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ),
  div[class*="max-h-[90vh]"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    ):not(.custom-scrollbar) {
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
  }

  /* Exception: Keep ScrollArea components working */
  [data-radix-scroll-area-root],
  [data-radix-scroll-area-viewport],
  .custom-scrollbar {
    /* These need their own scrollbars - handled separately */
  }

  /* AGGRESSIVE FIX: Prevent inner scrollbars on all main content containers */
  /* This targets any container that might be creating unwanted scrollbars */
  body > main,
  body > div > section,
  body > div > div[class*="container"],
  [class*="animate-ease-in-out"]:not([data-radix-scroll-area-root]):not([data-radix-scroll-area-viewport]),
  /* Target PageTransition wrapper */
  body > div[class*="framer-motion"] > div,
  /* Target any div with overflow-y-auto that's not explicitly needed */
  /* Exclude chatbot menu #cb-d-react and messages container so they keep overflow-y: auto and scroll */
  div[class*="overflow-y-auto"]:not(.custom-scrollbar):not([data-radix-scroll-area-viewport]):not(#cb-d-react):not(.chatbot-messages-scrollbar) {
    overflow-y: visible !important;
    overflow: visible !important;
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
  }

  body > main::-webkit-scrollbar,
  body > div > section::-webkit-scrollbar,
  body > div > div[class*="container"]::-webkit-scrollbar,
  [class*="animate-ease-in-out"]:not([data-radix-scroll-area-root]):not(
      [data-radix-scroll-area-viewport]
    )::-webkit-scrollbar,
  body > div[class*="framer-motion"] > div::-webkit-scrollbar,
  div[class*="overflow-y-auto"]:not(.custom-scrollbar):not(
      [data-radix-scroll-area-viewport]
    ):not(#cb-d-react):not(.chatbot-messages-scrollbar)::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  /* EXCEPTION: Keep ScrollArea custom scrollbars visible */
  /* Hide browser scrollbar on ScrollArea viewport (Radix handles custom scrollbar) */
  [data-radix-scroll-area-viewport] {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  [data-radix-scroll-area-viewport]::-webkit-scrollbar {
    display: none;
  }

  /* Custom Scrollbar Styles - ONLY for WorkPage list view */
  .custom-scrollbar {
    /* Reserve space for scrollbar to prevent layout shift */
    scrollbar-gutter: stable !important;
    scrollbar-width: thin !important;
    scrollbar-color: #00ff99 rgba(255, 255, 255, 0.05) !important;
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 8px !important;
    display: block !important; /* Show custom scrollbar */
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #00ff99;
    border-radius: 10px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #00cc7a;
  }

  /* Typewriter Cursor Blink Animation */
  .typewriter-cursor {
    display: inline-block;
    background-color: #00ff99;
    margin-left: 4px;
    animation: cursorBlink 1s step-end infinite;
    vertical-align: baseline;
  }

  .typewriter-cursor::after {
    content: "â–ˆ";
    color: #00ff99;
    font-size: 0.75em;
    font-weight: 100;
  }
}

@layer utilities {
  /* AGGRESSIVE: Override Radix UI react-remove-scroll padding/margin to prevent layout shift */
  /* This ensures no padding is added when dialogs open, since we hide the scrollbar */
  body[style*="padding-right"],
  body[style*="margin-right"],
  body.remove-scroll-bar,
  body[data-scroll-locked],
  html[style*="padding-right"],
  html[style*="margin-right"],
  html.remove-scroll-bar,
  html[data-scroll-locked],
  /* Target any element with Radix scroll lock classes */
  [data-radix-scroll-lock-body],
  [data-radix-scroll-lock-body] body {
    padding-right: 0 !important;
    margin-right: 0 !important;
  }

  @keyframes countUp {
    0% {
      transform: scale(0.8);
      opacity: 0;
    }
    50% {
      transform: scale(1.1);
      opacity: 0.8;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes dashRotate {
    0% {
      stroke-dasharray: 15 120 25 25;
    }
    25% {
      stroke-dasharray: 16 25 92 72;
    }
    50% {
      stroke-dasharray: 4 250 22 22;
    }
    75% {
      stroke-dasharray: 16 25 92 72;
    }
    100% {
      stroke-dasharray: 15 120 25 25;
    }
  }

  @keyframes easeInOut {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes easeOut {
    0% {
      opacity: 0;
      transform: translateY(5px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes easeIn {
    0% {
      opacity: 0;
      transform: translateY(8px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes accordionDown {
    from {
      height: 0;
    }
    to {
      height: var(--radix-accordion-content-height);
    }
  }

  @keyframes accordionUp {
    from {
      height: var(--radix-accordion-content-height);
    }
    to {
      height: 0;
    }
  }

  /* Counter animations for each number */
  @keyframes countTo5 {
    0% {
      content: "0";
    }
    20% {
      content: "1";
    }
    40% {
      content: "2";
    }
    60% {
      content: "3";
    }
    80% {
      content: "4";
    }
    100% {
      content: "5";
    }
  }

  @keyframes countTo93 {
    0% {
      content: "0";
    }
    1% {
      content: "1";
    }
    2% {
      content: "2";
    }
    3% {
      content: "3";
    }
    4% {
      content: "4";
    }
    5% {
      content: "5";
    }
    6% {
      content: "6";
    }
    7% {
      content: "7";
    }
    8% {
      content: "8";
    }
    9% {
      content: "9";
    }
    10% {
      content: "10";
    }
    15% {
      content: "15";
    }
    20% {
      content: "20";
    }
    25% {
      content: "25";
    }
    30% {
      content: "30";
    }
    35% {
      content: "35";
    }
    40% {
      content: "40";
    }
    45% {
      content: "45";
    }
    50% {
      content: "50";
    }
    55% {
      content: "55";
    }
    60% {
      content: "60";
    }
    65% {
      content: "65";
    }
    70% {
      content: "70";
    }
    75% {
      content: "75";
    }
    80% {
      content: "80";
    }
    85% {
      content: "85";
    }
    90% {
      content: "90";
    }
    95% {
      content: "93";
    }
    100% {
      content: "93";
    }
  }

  @keyframes countTo14 {
    0% {
      content: "0";
    }
    7% {
      content: "1";
    }
    14% {
      content: "2";
    }
    21% {
      content: "3";
    }
    28% {
      content: "4";
    }
    35% {
      content: "5";
    }
    42% {
      content: "6";
    }
    49% {
      content: "7";
    }
    56% {
      content: "8";
    }
    63% {
      content: "9";
    }
    70% {
      content: "10";
    }
    77% {
      content: "11";
    }
    84% {
      content: "12";
    }
    91% {
      content: "13";
    }
    100% {
      content: "14";
    }
  }

  @keyframes countTo849 {
    0% {
      content: "0";
    }
    1% {
      content: "1";
    }
    2% {
      content: "2";
    }
    3% {
      content: "3";
    }
    4% {
      content: "4";
    }
    5% {
      content: "5";
    }
    6% {
      content: "6";
    }
    7% {
      content: "7";
    }
    8% {
      content: "8";
    }
    9% {
      content: "9";
    }
    10% {
      content: "10";
    }
    15% {
      content: "20";
    }
    20% {
      content: "30";
    }
    25% {
      content: "40";
    }
    30% {
      content: "50";
    }
    35% {
      content: "60";
    }
    40% {
      content: "70";
    }
    45% {
      content: "80";
    }
    50% {
      content: "90";
    }
    55% {
      content: "100";
    }
    60% {
      content: "150";
    }
    65% {
      content: "200";
    }
    70% {
      content: "300";
    }
    75% {
      content: "400";
    }
    80% {
      content: "500";
    }
    85% {
      content: "600";
    }
    90% {
      content: "700";
    }
    95% {
      content: "800";
    }
    100% {
      content: "849";
    }
  }

  @keyframes cursorBlink {
    0%,
    49% {
      opacity: 1;
    }
    50%,
    100% {
      opacity: 0;
    }
  }

  /* Custom scrollbar styling for chatbot messages container */
  .chatbot-messages-scrollbar::-webkit-scrollbar {
    width: 6px; /* Thin scrollbar */
    display: block !important; /* Always show scrollbar when content overflows */
  }

  .chatbot-messages-scrollbar::-webkit-scrollbar-track {
    background: transparent; /* Transparent track */
    border: none; /* No border */
  }

  .chatbot-messages-scrollbar::-webkit-scrollbar-thumb {
    background: rgb(229, 231, 235); /* Light gray for light mode */
    border-radius: 3px;
  }

  .chatbot-messages-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgb(209, 213, 219); /* Slightly darker on hover in light mode */
  }

  /* Dark mode scrollbar styling */
  .dark .chatbot-messages-scrollbar::-webkit-scrollbar-track {
    background: transparent; /* Transparent track - matches chat body bg (gray-950) */
    border: none; /* No border */
  }

  .dark .chatbot-messages-scrollbar::-webkit-scrollbar-thumb {
    background: rgb(17, 24, 39); /* gray-900 - same as header bg */
    border-radius: 3px;
  }

  .dark .chatbot-messages-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgb(31, 41, 55); /* Slightly lighter on hover */
  }

  /* Firefox scrollbar styling */
  .chatbot-messages-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgb(229, 231, 235) transparent; /* Light mode: gray thumb, transparent track */
  }

  .dark .chatbot-messages-scrollbar {
    scrollbar-color: rgb(17, 24, 39) transparent; /* Dark mode: gray-900 thumb, transparent track */
  }

  /* Ensure messages container has proper scrolling */
  #cb-react .chatbot-messages-scrollbar {
    min-height: 0 !important;
    max-height: 100% !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }

  /* Ensure chatbot widget rounded corners are properly displayed */
  /* Prevent any overlay or background from covering the rounded corners */
  #cb-react,
  [id="cb-react"] {
    border-radius: 1rem !important;
    overflow: hidden !important;
    isolation: isolate !important;
    contain: layout style paint !important;
    background-clip: padding-box !important;
    /* Remove all default focus outlines */
    outline: none !important;
    /* Ensure smooth border color transitions - synchronized with child elements */
    transition:
      border-color 0.2s ease-in-out,
      background-color 0.2s ease-in-out !important;
    /* Ensure flex layout works correctly - header and input stay visible */
    display: flex !important;
    flex-direction: column !important;
  }

  /* CRITICAL: Ensure header is always visible on mobile - prevent clipping */
  #cb-react > div:first-child,
  [id="cb-react"] > div:first-child {
    /* Ensure header is always visible and not clipped */
    position: relative !important;
    flex-shrink: 0 !important;
    z-index: 100000 !important;
    /* Prevent header from being pushed out of view */
    min-height: auto !important;
  }

  /* Ensure messages container scrolls properly without hiding header */
  #cb-react > div:nth-child(2),
  [id="cb-react"] > div:nth-child(2) {
    /* Messages container should scroll, not push header out */
    flex: 1 1 auto !important;
    min-height: 0 !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }

  /* Ensure input form stays at bottom */
  #cb-react > form:last-child,
  [id="cb-react"] > form:last-child {
    flex-shrink: 0 !important;
    position: relative !important;
  }

  /* Synchronize all child element transitions with parent */
  #cb-react > *,
  [id="cb-react"] > * {
    transition:
      background-color 0.2s ease-in-out,
      border-color 0.2s ease-in-out !important;
  }

  /* Remove focus outline from widget body - prevent flash on mode change */
  #cb-react:focus,
  #cb-react:focus-visible,
  #cb-react:focus-within,
  [id="cb-react"]:focus,
  [id="cb-react"]:focus-visible,
  [id="cb-react"]:focus-within {
    outline: none !important;
    box-shadow: none !important;
  }

  /* Prevent any white background from bleeding through during theme transitions */
  #cb-react::before,
  #cb-react::after,
  [id="cb-react"]::before,
  [id="cb-react"]::after {
    display: none !important;
  }

  /* Ensure no parent elements clip the widget's rounded corners */
  body > div:has(#cb-react),
  body > div:has([id="cb-react"]) {
    overflow: visible !important;
  }

  /* =========================================================
     HARD ISOLATION FIX FOR CHATBOT DROPDOWN (MOBILE)
     ========================================================= */
  /* Portaled menu: keep absolute so it stays right-aligned in the widget body */
  #cb-d-react[data-portal-menu],
  [id="cb-d-react"][data-portal-menu] {
    position: absolute !important;
  }

  #cb-d-react,
  [id="cb-d-react"] {
    position: relative !important;

    /* Enforce the 350px boundary on mobile */
    max-height: 350px !important;
    height: auto !important;

    /* THIS enables scrolling */
    overflow-y: auto !important;
    overflow-x: hidden !important;

    /* Break out of parent overflow: visible */
    contain: layout paint !important;
    isolation: isolate !important;

    /* iOS momentum scrolling */
    -webkit-overflow-scrolling: touch !important;

    /* Ensure it receives touch events */
    touch-action: pan-y !important;
  }

  /* Desktop: allow larger menu height */
  @media (min-width: 640px) {
    #cb-d-react,
    [id="cb-d-react"] {
      max-height: 540px !important;
    }
  }
}
